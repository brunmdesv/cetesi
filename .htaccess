# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On

# Adjust this base if your site is not in a subdirectory
RewriteBase /

RewriteRule ^index\.php$ - [L]
# Pass non-existing files/directories to WordPress
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>
# END WordPress

# Optional: disable directory listing (uncomment if desired)
# Options -Indexes

# === Security hardening ===
<IfModule mod_autoindex.c>
    Options -Indexes
</IfModule>

# Protect sensitive files
<FilesMatch "^(wp-config\.php|readme\.html|license\.txt|\.env|composer\.json|composer\.lock)$">
    Require all denied
</FilesMatch>

# Deny access to .htaccess itself
<Files ~ "^\.ht">
    Require all denied
</Files>

# Block PHP execution in uploads (defense-in-depth)
# Create a separate .htaccess inside wp-content/uploads for stricter rules
# Or uncomment the following rule to deny PHP served from uploads via rewrite
# <IfModule mod_rewrite.c>
#     RewriteEngine On
#     RewriteRule ^wp-content/uploads/.*\.(php|phtml|php\d?)$ - [F]
# </IfModule>

# Optional: disable XML-RPC if you do not use it (Jetpack/mobile app need it)
# <Files xmlrpc.php>
#     Require all denied
# </Files>

# === Performance ===
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css application/xml application/xhtml+xml application/rss+xml application/javascript application/x-javascript application/json image/svg+xml
</IfModule>

<IfModule mod_mime.c>
    AddType application/font-woff2 .woff2
    AddType application/font-woff .woff
    AddType application/vnd.ms-fontobject .eot
    AddType font/ttf .ttf
    AddType font/otf .otf
    AddType image/svg+xml .svg .svgz
    AddEncoding gzip .svgz
</IfModule>

<IfModule mod_headers.c>
    # CORS for fonts
    <FilesMatch "\.(eot|otf|ttf|woff|woff2|svg)$">
        Header set Access-Control-Allow-Origin "*"
    </FilesMatch>
    # Cache-Control for static assets (override via querystring busting)
    <FilesMatch "\.(ico|pdf|flv|jpg|jpeg|png|gif|svg|webp|css|js|woff|woff2|ttf|otf)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </FilesMatch>
</IfModule>

<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresDefault "access plus 1 month"
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType application/x-javascript "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/svg+xml "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType font/ttf "access plus 1 year"
    ExpiresByType font/otf "access plus 1 year"
    ExpiresByType application/font-woff "access plus 1 year"
    ExpiresByType application/font-woff2 "access plus 1 year"
</IfModule>


